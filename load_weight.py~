import torch
from vggt.models.vggt import VGGT
from vggt.utils.load_fn import load_and_preprocess_images

from pathlib import Path

def list_files_in_dir(relative_dir: str):
    dir_path = Path(relative_dir)         # relative to current working directory
    return [str(p) for p in dir_path.glob('*') if p.is_file()]

# get the anafi captured images
files = list_files_in_dir("anafi_usa_20250812-selected")
print(f"files: {files}")

# device = "cuda" if torch.cuda.is_available() else "cpu"
device = torch.device("cuda:1")
# bfloat16 is supported on Ampere GPUs (Compute Capability 8.0+)
dtype = torch.bfloat16 if torch.cuda.get_device_capability()[0] >= 8 else torch.float16

# Initialize the model and load the pretrained weights.
# This will automatically download the model weights the first time it's run, which may take a while.
model = VGGT.from_pretrained("facebook/VGGT-1B").to(device)

# Load and preprocess example images (replace with your own image paths)
files
images = load_and_preprocess_images(files).to(device)

with torch.no_grad():
    with torch.cuda.amp.autocast(dtype=dtype):
        # Predict attributes including cameras, depth maps, and point maps.
        predictions = model(images)
